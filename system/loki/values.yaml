loki:
  loki:
    schemaConfig:
      configs:
      - from: 2025-01-01
        store: tsdb
        object_store: s3
        schema: v13
        index:
          prefix: loki_index_
          period: 24h

    storage-config:
      aws:
        endpoint: garage.garage.svc.cluster.local:3900
        region: garage
        access_key_id: ${S3_KEY_ID}
        secret_access_key: ${S3_KEY_SECRET}
        insecure: true
        s3forcepathstyle: true
        bucketnames: loki-chunks
      tsdb_shipper:
        active_index_directory: /loki/index
        cache_location: /loki/index_cache
        cache_ttl: 24h
    storage:
      type: s3
      bucketNames:
        chunks: loki-chunks
        ruler: loki-ruler
        admin: loki-admin
      s3:
        endpoint: garage.garage.svc.cluster.local:3900
        region: garage
        access_key_id: ${S3_KEY_ID}
        secret_access_key: ${S3_KEY_SECRET}
        insecure: true
        s3forcepathstyle: true

    auth_enabled: false
    pattern_ingester:
      enabled: true
    limits_config:
      allow_structured_metadata: true
      volume_enabled: true
      retention_period: 336h # 14 days
    compactor:
      retention_enabled: true
      delete_request_store: s3

  chunksCache:
    writebackSizeLimit: 10MB
    allocatedMemory: 1024

  deploymentMode: SingleBinary
  singleBinary:
    replicas: 3
    resources:
      requests:
        cpu: 500m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 384Mi
    extraEnv:
    - name: GOMEMLIMIT
      value: 250MiB
    extraEnvFrom:
    - secretRef:
        name: s3-key
    extraArgs:
    - -config.expand-env=true

  backend:
    replicas: 0
  read:
    replicas: 0
  write:
    replicas: 0
  ingester:
    replicas: 0
  querier:
    replicas: 0
  queryFrontend:
    replicas: 0
  queryScheduler:
    replicas: 0
  distributor:
    replicas: 0
  compactor:
    replicas: 0
  indexGateway:
    replicas: 0
  bloomCompactor:
    replicas: 0
  bloomGateway:
    replicas: 0

promtail:
  config:
    logLevel: info
    clients:
    - url: http://loki-gateway.loki.svc.cluster.local/loki/api/v1/push
